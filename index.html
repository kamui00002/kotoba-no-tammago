<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ことばのたまご - 完全版</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Hiragino Kaku Gothic Pro', 'メイリオ', sans-serif;
            background: linear-gradient(135deg, #f5f0ff 0%, #e8d4ff 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .phone-container {
            width: 390px;
            height: 844px;
            background: white;
            border-radius: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            position: relative;
        }
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: none;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .screen.active { display: block; opacity: 1; }
        .splash-screen {
            background: linear-gradient(135deg, #1a0033 0%, #4a148c 50%, #7b1fa2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .app-icon {
            width: 150px;
            height: 150px;
            background: white;
            border-radius: 35px;
            margin-bottom: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 80px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .app-title {
            font-size: 36px;
            font-weight: bold;
            color: white;
            margin-bottom: 10px;
        }
        .app-subtitle {
            font-size: 14px;
            color: #E8D4FF;
            text-align: center;
            padding: 0 40px;
        }
        .loading-dots { display: flex; gap: 8px; margin-top: 40px; }
        .dot {
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
            animation: dotBounce 1.4s infinite ease-in-out both;
        }
        .dot:nth-child(1) { animation-delay: -0.32s; }
        .dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes dotBounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
        .quiz-header {
            height: 60px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            background: rgba(255,255,255,0.95);
            border-bottom: 1px solid #f0f0f0;
        }
        .character-section {
            padding: 30px 20px 20px;
            background: linear-gradient(to bottom, rgba(184,164,232,0.1), transparent);
        }
        .character-container { display: flex; align-items: flex-start; gap: 15px; }
        .character-avatar {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #B8A4E8 0%, #9B7ED9 100%);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 35px;
        }
        .speech-bubble {
            background: white;
            border-radius: 20px;
            padding: 15px 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
            max-width: 260px;
            font-size: 15px;
            color: #333;
        }
        .speech-bubble::before {
            content: '';
            position: absolute;
            left: -10px;
            top: 20px;
            border-style: solid;
            border-width: 10px 15px 10px 0;
            border-color: transparent white transparent transparent;
        }
        .question-area { padding: 20px; }
        .question-text {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }
        .choices { display: flex; flex-direction: column; gap: 15px; }
        .choice-button {
            background: white;
            border: 2px solid #ddd;
            border-radius: 20px;
            padding: 20px;
            font-size: 16px;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            z-index: 10;
        }
        .choice-button:hover {
            background: #f5f0ff;
            border-color: #9B7ED9;
            transform: translateX(5px);
        }
        .choice-button:active {
            background: #e8d4ff;
        }
        .result-screen {
            background: linear-gradient(135deg, #1a0033 0%, #4a148c 50%, #7b1fa2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            text-align: center;
        }
        .result-character { font-size: 120px; margin-bottom: 20px; }
        .result-title { font-size: 28px; font-weight: bold; color: white; margin-bottom: 10px; }
        .result-subtitle { font-size: 22px; color: #E8D4FF; margin-bottom: 20px; }
        .result-description { font-size: 16px; color: white; line-height: 1.8; margin-bottom: 30px; max-width: 300px; }
        .continue-button {
            padding: 15px 40px;
            background: white;
            color: #9B7ED9;
            border: none;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            z-index: 100;
            position: relative;
        }
        .continue-button:hover {
            background: #f5f0ff;
            transform: scale(1.05);
        }
        .continue-button:active {
            background: #e8d4ff;
            transform: scale(0.98);
        }
        .level-select-screen {
            background-image: linear-gradient(to bottom, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 60px, rgba(255,255,255,0.7) 200px, rgba(255,255,255,0.85) 500px, rgba(255,255,255,0.95) 100%), linear-gradient(135deg, #1a0033 0%, #4a148c 50%, #7b1fa2 100%);
            padding: 80px 20px 40px;
        }
        .level-title { font-size: 24px; font-weight: bold; color: #333; text-align: center; margin-bottom: 10px; }
        .level-subtitle { font-size: 16px; color: #666; text-align: center; margin-bottom: 40px; }
        .level-buttons { display: flex; flex-direction: column; gap: 20px; padding: 0 20px; }
        .level-button {
            background: white;
            border: 3px solid #9B7ED9;
            border-radius: 25px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 100;
            position: relative;
        }
        .level-button:hover { 
            transform: translateY(-5px); 
            background: #f5f0ff;
        }
        .level-button:active {
            background: #e8d4ff;
            transform: translateY(-2px);
        }
        .level-icon { font-size: 40px; margin-bottom: 10px; }
        .level-name { font-size: 20px; font-weight: bold; color: #9B7ED9; margin-bottom: 5px; }
        .level-desc { font-size: 14px; color: #666; }
        .home-screen {
            background-image: linear-gradient(to bottom, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 60px, rgba(255,255,255,0.7) 200px, rgba(255,255,255,0.85) 500px, rgba(255,255,255,0.95) 100%), linear-gradient(135deg, #1a0033 0%, #4a148c 50%, #7b1fa2 100%);
        }
        .home-header {
            height: 60px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            background: rgba(255,255,255,0.9);
        }
        .icon { font-size: 24px; cursor: pointer; position: relative; z-index: 100; }
        .home-content { padding: 20px; text-align: center; }
        .character-name { color: #9B7ED9; font-size: 18px; font-weight: bold; margin-bottom: 5px; }
        .level { color: #FFD700; font-size: 24px; font-weight: bold; margin-bottom: 20px; }
        .character-display {
            width: 250px;
            height: 250px;
            margin: 0 auto 20px;
            background: #B8A4E8;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 80px;
            cursor: pointer;
        }
        .exp-container { margin: 20px 0; }
        .exp-bar { width: 100%; height: 20px; background: #f0f0f0; border-radius: 10px; overflow: hidden; margin-bottom: 8px; }
        .exp-progress { height: 100%; background: linear-gradient(90deg, #B8A4E8 0%, #9B7ED9 100%); transition: width 1s; }
        .exp-text { color: #666; font-size: 14px; }
        .quiz-start-button {
            width: 85%;
            margin: 20px auto;
            padding: 18px;
            background: linear-gradient(135deg, #9B7ED9 0%, #B8A4E8 100%);
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            z-index: 100;
            position: relative;
            display: block;
        }
        .quiz-start-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(155,126,217,0.5);
        }
        .quiz-start-button:active {
            transform: translateY(0);
            box-shadow: 0 5px 15px rgba(155,126,217,0.4);
        }
        .stats { display: flex; justify-content: center; gap: 40px; margin-top: 20px; color: #888; font-size: 14px; }
        .mini-character {
            width: 90px;
            height: 90px;
            background: #B8A4E8;
            border-radius: 50%;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            font-size: 45px;
            margin-bottom: 10px;
        }
        .cheer-message { font-size: 14px; color: #9B7ED9; font-weight: bold; }
        .question-card {
            background: white;
            border-radius: 20px;
            padding: 25px 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            text-align: center;
            margin-bottom: 20px;
        }
        .word { font-size: 25px; font-weight: bold; color: #333; margin-bottom: 8px; }
        .question-text-small { font-size: 14px; color: #666; }
        .choice-button.correct { background: #d4edda; border-color: #28a745; }
        .choice-button.wrong { background: #f8d7da; border-color: #dc3545; }
        .quiz-result-screen {
            background-image: linear-gradient(to bottom, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 60px, rgba(255,255,255,0.7) 200px, rgba(255,255,255,0.85) 500px, rgba(255,255,255,0.95) 100%), linear-gradient(135deg, #1a0033 0%, #4a148c 50%, #7b1fa2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            text-align: center;
        }
        .result-big-character { font-size: 100px; margin-bottom: 20px; }
        .result-stats { font-size: 28px; color: #333; font-weight: bold; margin-bottom: 20px; }
        .exp-earned { font-size: 32px; color: #FFD700; font-weight: bold; margin-bottom: 30px; }
        
        .level-up-screen {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FF6347 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .level-up-character {
            font-size: 150px;
            margin-bottom: 20px;
            animation: levelUpBounce 0.8s ease-in-out;
        }
        @keyframes levelUpBounce {
            0% { transform: scale(0) rotate(0deg); }
            50% { transform: scale(1.2) rotate(180deg); }
            100% { transform: scale(1) rotate(360deg); }
        }
        .level-up-title {
            font-size: 48px;
            font-weight: bold;
            color: white;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
            margin-bottom: 20px;
            animation: slideDown 0.6s ease-out;
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .level-number {
            font-size: 72px;
            font-weight: bold;
            color: white;
            text-shadow: 4px 4px 8px rgba(0,0,0,0.4);
            margin-bottom: 30px;
            animation: scaleIn 0.8s ease-out 0.3s both;
        }
        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0); }
            to { opacity: 1; transform: scale(1); }
        }
        .sparkle {
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            animation: sparkleFloat 2s ease-in-out infinite;
            box-shadow: 0 0 10px white;
        }
        @keyframes sparkleFloat {
            0%, 100% { transform: translateY(0) scale(1); opacity: 1; }
            50% { transform: translateY(-30px) scale(1.5); opacity: 0.5; }
        }
        .sparkle:nth-child(1) { top: 20%; left: 10%; animation-delay: 0s; }
        .sparkle:nth-child(2) { top: 30%; left: 80%; animation-delay: 0.3s; }
        .sparkle:nth-child(3) { top: 60%; left: 15%; animation-delay: 0.6s; }
        .sparkle:nth-child(4) { top: 70%; left: 85%; animation-delay: 0.9s; }
        .sparkle:nth-child(5) { top: 40%; left: 50%; animation-delay: 1.2s; }
        .level-up-message {
            font-size: 20px;
            color: white;
            margin-bottom: 30px;
            animation: fadeIn 1s ease-out 0.6s both;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }
        .settings-modal.active { display: flex; }
        .settings-content {
            background: linear-gradient(135deg, #1a0033 0%, #4a148c 50%, #7b1fa2 100%);
            border-radius: 30px;
            width: 100%;
            max-width: 350px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        .settings-title {
            font-size: 24px;
            font-weight: bold;
            color: white;
        }
        .settings-close {
            font-size: 28px;
            color: white;
            cursor: pointer;
            background: none;
            border: none;
            opacity: 0.8;
            transition: opacity 0.3s;
        }
        .settings-close:hover { opacity: 1; }
        .settings-body { padding: 20px; }
        .settings-section {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
        }
        .settings-section-title {
            font-size: 16px;
            font-weight: bold;
            color: #E8D4FF;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .settings-item {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
        }
        .settings-item:last-child { margin-bottom: 0; }
        .settings-label {
            font-size: 14px;
            color: #B8A4E8;
            margin-bottom: 5px;
        }
        .settings-value {
            font-size: 16px;
            color: white;
            font-weight: 600;
        }
        .settings-button {
            background: linear-gradient(135deg, #9B7ED9 0%, #B8A4E8 100%);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
            width: 100%;
        }
        .settings-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(155,126,217,0.5);
        }
        .settings-button.danger {
            background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
        }
        .settings-button.danger:hover {
            box-shadow: 0 5px 15px rgba(220,38,38,0.5);
        }
        .settings-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .debug-buttons {
            display: flex;
            gap: 10px;
        }
        .debug-buttons .settings-button {
            width: auto;
            flex: 1;
        }
        
        .stats-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }
        .stats-modal.active { display: flex; }
        .stats-content {
            background: linear-gradient(135deg, #1e3a8a 0%, #4c1d95 100%);
            border-radius: 30px;
            width: 100%;
            max-width: 350px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }
        .stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        .stats-title {
            font-size: 24px;
            font-weight: bold;
            color: white;
        }
        .stats-close {
            font-size: 28px;
            color: white;
            cursor: pointer;
            background: none;
            border: none;
            opacity: 0.8;
            transition: opacity 0.3s;
        }
        .stats-close:hover { opacity: 1; }
        .stats-body { padding: 20px; }
        .stats-card {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
        }
        .stats-card-title {
            font-size: 16px;
            font-weight: bold;
            color: #93c5fd;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .stat-row:last-child { border-bottom: none; }
        .stat-label {
            font-size: 14px;
            color: #cbd5e1;
        }
        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: white;
        }
        .progress-bar-container {
            margin: 10px 0;
        }
        .progress-label {
            font-size: 12px;
            color: #cbd5e1;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }
        .progress-bar-stats {
            width: 100%;
            height: 8px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            overflow: hidden;
        }
        .progress-fill-stats {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s;
        }
        .progress-beginner { background: linear-gradient(90deg, #22c55e, #16a34a); }
        .progress-intermediate { background: linear-gradient(90deg, #eab308, #ca8a04); }
        .progress-advanced { background: linear-gradient(90deg, #ef4444, #dc2626); }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 10px;
        }
        .calendar-day {
            aspect-ratio: 1;
            background: rgba(0,0,0,0.3);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #94a3b8;
        }
        .calendar-day.studied {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
            font-weight: bold;
        }
        .calendar-day.today {
            border: 2px solid #60a5fa;
        }
        .word-list {
            max-height: 150px;
            overflow-y: auto;
        }
        .word-item {
            background: rgba(0,0,0,0.2);
            padding: 8px 12px;
            border-radius: 8px;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .word-name {
            font-size: 14px;
            color: white;
        }
        .word-accuracy {
            font-size: 12px;
            font-weight: bold;
        }
        .word-accuracy.good { color: #22c55e; }
        .word-accuracy.bad { color: #ef4444; }
        .big-stat {
            text-align: center;
            padding: 20px;
        }
        .big-stat-number {
            font-size: 48px;
            font-weight: bold;
            color: #fbbf24;
            margin-bottom: 5px;
        }
        .big-stat-label {
            font-size: 14px;
            color: #cbd5e1;
        }
    </style>
</head>
<body>
    <div class="phone-container">
        <!-- スプラッシュ画面 -->
        <div class="screen splash-screen active" id="splashScreen">
            <div class="app-icon">🥚</div>
            <div class="app-title">ことばのたまご</div>
            <div class="app-subtitle">～育てて学ぶ、あなただけの英単語～</div>
            <div class="loading-dots">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
        </div>

        <!-- MBTI診断画面 -->
        <div class="screen" id="mbtiScreen">
            <div class="quiz-header">
                <div style="font-size: 18px; font-weight: bold; color: #9B7ED9;">問題 <span id="mbtiCurrentQ">1</span>/16</div>
            </div>
            <div class="character-section">
                <div class="character-container">
                    <div class="character-avatar" id="mbtiCharAvatar">🌙</div>
                    <div class="speech-bubble" id="mbtiBubble"></div>
                </div>
            </div>
            <div class="question-area">
                <div class="question-text" id="mbtiQuestion"></div>
                <div class="choices" id="mbtiChoices"></div>
            </div>
        </div>

        <!-- 診断結果画面 -->
        <div class="screen result-screen" id="resultScreen">
            <div class="result-character" id="resultChar">🌙</div>
            <div class="result-title" id="resultType">INFP</div>
            <div class="result-subtitle" id="resultName">夢見る魔法使い</div>
            <div class="result-description" id="resultDesc"></div>
            <button class="continue-button" id="continueBtn">次へ →</button>
        </div>

        <!-- レベルアップ画面 -->
        <div class="screen level-up-screen" id="levelUpScreen">
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="level-up-character" id="levelUpChar">🌟</div>
            <div class="level-up-title">LEVEL UP!</div>
            <div class="level-number">Lv.<span id="newLevelNumber">2</span></div>
            <div class="level-up-message" id="levelUpMessage">おめでとうございます！</div>
            <button class="continue-button" id="levelUpContinueBtn">続ける →</button>
        </div>

        <!-- レベル選択画面 -->
        <div class="screen level-select-screen" id="levelSelectScreen">
            <div class="level-title">英語レベルを選択</div>
            <div class="level-subtitle">どのレベルで学習しますか?</div>
            <div class="level-buttons">
                <div class="level-button" id="levelBeginner">
                    <div class="level-icon">🌱</div>
                    <div class="level-name">初級</div>
                    <div class="level-desc">中学英語・日常英単語</div>
                </div>
                <div class="level-button" id="levelIntermediate">
                    <div class="level-icon">📚</div>
                    <div class="level-name">中級</div>
                    <div class="level-desc">TOEIC頻出単語</div>
                </div>
                <div class="level-button" id="levelAdvanced">
                    <div class="level-icon">🎓</div>
                    <div class="level-name">上級</div>
                    <div class="level-desc">難関英単語</div>
                </div>
            </div>
        </div>

        <!-- ホーム画面 -->
        <div class="screen home-screen" id="homeScreen">
            <div class="home-header">
                <div class="icon" id="settingsBtn" onclick="openSettings()" style="cursor: pointer; z-index: 100;">⚙️</div>
                <div class="icon">🏠</div>
                <div class="icon" id="statsBtn" onclick="openStats()" style="cursor: pointer; z-index: 100;">📊</div>
            </div>
            <div class="home-content">
                <div class="character-name" id="homeCharName">INFP - 夢見る魔法使い</div>
                <div class="level" id="homeLevel">Lv.1</div>
                <div class="character-display" id="homeCharacter">🌙</div>
                <div class="exp-container">
                    <div class="exp-bar">
                        <div class="exp-progress" id="homeExpBar" style="width: 0%"></div>
                    </div>
                    <div class="exp-text">⭐ <span id="homeExp">0</span> / <span id="homeMaxExp">100</span> EXP</div>
                </div>
                <button class="quiz-start-button" id="quizStartBtn">
                    📝 英語クイズ開始
                    <div style="font-size: 12px; margin-top: 5px; opacity: 0.9;">今日 <span id="todayCount">0</span>/10回</div>
                </button>
                <div class="stats">
                    <div>🔥 <span id="consecutiveDays">1</span>日目</div>
                    <div>📚 単語<span id="totalWords">0</span>個</div>
                </div>
            </div>
        </div>

        <!-- クイズ画面 -->
        <div class="screen" id="quizScreen" style="background-image: linear-gradient(to bottom, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 60px, rgba(255,255,255,0.7) 200px, rgba(255,255,255,0.85) 400px, rgba(255,255,255,0.95) 100%), linear-gradient(135deg, #1a0033 0%, #4a148c 50%, #7b1fa2 100%);">
            <div class="quiz-header">
                <div style="font-size: 18px; font-weight: bold; color: #333;">問題 <span id="quizNum">1</span>/10</div>
            </div>
            <div style="padding: 25px 20px 20px; text-align: center;">
                <div class="mini-character" id="quizChar">🌙</div>
                <div class="cheer-message" id="cheerMsg">頑張って!</div>
            </div>
            <div style="padding: 20px;">
                <div class="question-card">
                    <div class="word" id="quizWord">apple</div>
                    <div class="question-text-small">の意味は?</div>
                </div>
            </div>
            <div class="choices" style="padding: 0 20px;" id="quizChoices"></div>
        </div>

        <!-- クイズ結果画面 -->
        <div class="screen quiz-result-screen" id="quizResultScreen">
            <div class="result-big-character" id="quizResultChar">🌙😊</div>
            <div style="font-size: 32px; font-weight: bold; color: #9B7ED9; margin-bottom: 20px;">クイズ完了!</div>
            <div class="result-stats">正解: <span id="finalScore">0</span>/10</div>
            <div class="exp-earned">+<span id="finalExpEarned">0</span> EXP</div>
            <button class="continue-button" id="backHomeBtn">ホームへ戻る</button>
        </div>

        <!-- 設定モーダル -->
        <div class="settings-modal" id="settingsModal">
            <div class="settings-content">
                <div class="settings-header">
                    <div class="settings-title">⚙️ 設定</div>
                    <button class="settings-close" id="closeSettings">×</button>
                </div>
                <div class="settings-body">
                    <div class="settings-section">
                        <div class="settings-section-title">👤 アカウント</div>
                        <div class="settings-item">
                            <div class="settings-label">MBTIタイプ</div>
                            <div class="settings-value" id="settingsMBTI">INFP - 夢見る魔法使い</div>
                            <button class="settings-button" id="retakeMBTI">MBTI再診断</button>
                        </div>
                        <div class="settings-item">
                            <div class="settings-label">学習レベル</div>
                            <div class="settings-value" id="settingsLevel">初級</div>
                            <button class="settings-button" id="changeLevel">レベル変更</button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-section-title">📊 データ</div>
                        <div class="settings-item">
                            <div class="settings-row">
                                <div>
                                    <div class="settings-label">現在のレベル</div>
                                    <div class="settings-value" id="settingsCurrentLevel">Lv.1</div>
                                </div>
                                <div style="text-align: right;">
                                    <div class="settings-label">経験値</div>
                                    <div class="settings-value" id="settingsExp">0 / 100</div>
                                </div>
                            </div>
                        </div>
                        <div class="settings-item">
                            <div class="settings-label">累計学習単語</div>
                            <div class="settings-value" id="settingsTotalWords">0個</div>
                        </div>
                        <div class="settings-item">
                            <div class="settings-label">連続学習日数</div>
                            <div class="settings-value" id="settingsStreak">🔥 1日</div>
                        </div>
                        <div class="settings-item">
                            <button class="settings-button danger" id="resetData">データをリセット</button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-section-title">🔧 デバッグモード</div>
                        <div class="settings-item">
                            <div class="settings-label">テスト用機能</div>
                            <div class="debug-buttons">
                                <button class="settings-button" id="addExp100">+100 EXP</button>
                                <button class="settings-button" id="addLevel1">+1 Level</button>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-section-title">ℹ️ アプリ情報</div>
                        <div class="settings-item">
                            <div class="settings-row">
                                <div class="settings-label">バージョン</div>
                                <div class="settings-value">v2.0.0</div>
                            </div>
                        </div>
                        <div class="settings-item">
                            <div class="settings-row">
                                <div class="settings-label">作成者</div>
                                <div class="settings-value">kamui00002</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 統計モーダル -->
        <div class="stats-modal" id="statsModal">
            <div class="stats-content">
                <div class="stats-header">
                    <div class="stats-title">📊 学習統計</div>
                    <button class="stats-close" id="closeStats">×</button>
                </div>
                <div class="stats-body">
                    <div class="stats-card">
                        <div class="stats-card-title">🎯 総合成績</div>
                        <div class="stat-row">
                            <span class="stat-label">総クイズ数</span>
                            <span class="stat-value" id="statTotalQuizzes">0回</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">総正解数</span>
                            <span class="stat-value" id="statTotalCorrect">0問</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">平均正答率</span>
                            <span class="stat-value" id="statAccuracy">0%</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">学習した単語</span>
                            <span class="stat-value" id="statTotalWords">0個</span>
                        </div>
                    </div>

                    <div class="stats-card">
                        <div class="stats-card-title">📚 レベル別進捗</div>
                        <div class="progress-bar-container">
                            <div class="progress-label">
                                <span>🌱 初級</span>
                                <span id="progressBeginnerText">0/30</span>
                            </div>
                            <div class="progress-bar-stats">
                                <div class="progress-fill-stats progress-beginner" id="progressBeginner" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-label">
                                <span>📚 中級</span>
                                <span id="progressIntermediateText">0/30</span>
                            </div>
                            <div class="progress-bar-stats">
                                <div class="progress-fill-stats progress-intermediate" id="progressIntermediate" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-label">
                                <span>🎓 上級</span>
                                <span id="progressAdvancedText">0/30</span>
                            </div>
                            <div class="progress-bar-stats">
                                <div class="progress-fill-stats progress-advanced" id="progressAdvanced" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>

                    <div class="stats-card">
                        <div class="stats-card-title">🔥 連続学習カレンダー</div>
                        <div class="big-stat">
                            <div class="big-stat-number" id="streakDays">0</div>
                            <div class="big-stat-label">日連続学習中！</div>
                        </div>
                        <div class="calendar-grid" id="calendarGrid"></div>
                    </div>

                    <div class="stats-card">
                        <div class="stats-card-title">⏰ 累計学習時間</div>
                        <div class="big-stat">
                            <div class="big-stat-number" id="studyTimeDisplay">0</div>
                            <div class="big-stat-label">分</div>
                        </div>
                    </div>

                    <div class="stats-card">
                        <div class="stats-card-title">📖 単語分析</div>
                        <div style="margin-bottom: 15px;">
                            <div style="font-size: 14px; color: #cbd5e1; margin-bottom: 8px;">得意な単語 TOP 3</div>
                            <div class="word-list" id="goodWords"></div>
                        </div>
                        <div>
                            <div style="font-size: 14px; color: #cbd5e1; margin-bottom: 8px;">苦手な単語 TOP 3</div>
                            <div class="word-list" id="badWords"></div>
                        </div>
                    </div>

                    <div class="stats-card">
                        <div class="stats-card-title">ℹ️ アプリ情報</div>
                        <div class="stat-row">
                            <span class="stat-label">バージョン</span>
                            <span class="stat-value">v2.0.0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">作成者</span>
                            <span class="stat-value">kamui00002</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
    <script>
        const wordsData={"初級":[{"id":1,"word":"apple","meaning":"りんご","wrongChoices":["バナナ","オレンジ","ぶどう"]},{"id":2,"word":"book","meaning":"本","wrongChoices":["ペン","机","椅子"]},{"id":3,"word":"cat","meaning":"猫","wrongChoices":["犬","鳥","魚"]},{"id":4,"word":"dog","meaning":"犬","wrongChoices":["猫","馬","牛"]},{"id":5,"word":"egg","meaning":"卵","wrongChoices":["パン","米","肉"]},{"id":6,"word":"fish","meaning":"魚","wrongChoices":["肉","野菜","果物"]},{"id":7,"word":"house","meaning":"家","wrongChoices":["学校","病院","店"]},{"id":8,"word":"pen","meaning":"ペン","wrongChoices":["鉛筆","消しゴム","ノート"]},{"id":9,"word":"desk","meaning":"机","wrongChoices":["椅子","棚","ベッド"]},{"id":10,"word":"chair","meaning":"椅子","wrongChoices":["机","ソファ","ベンチ"]},{"id":11,"word":"eat","meaning":"食べる","wrongChoices":["飲む","見る","聞く"]},{"id":12,"word":"drink","meaning":"飲む","wrongChoices":["食べる","歩く","走る"]},{"id":13,"word":"run","meaning":"走る","wrongChoices":["歩く","泳ぐ","飛ぶ"]},{"id":14,"word":"walk","meaning":"歩く","wrongChoices":["走る","止まる","座る"]},{"id":15,"word":"sleep","meaning":"眠る","wrongChoices":["起きる","食べる","遊ぶ"]},{"id":16,"word":"read","meaning":"読む","wrongChoices":["書く","話す","聞く"]},{"id":17,"word":"write","meaning":"書く","wrongChoices":["読む","消す","描く"]},{"id":18,"word":"speak","meaning":"話す","wrongChoices":["聞く","見る","書く"]},{"id":19,"word":"listen","meaning":"聞く","wrongChoices":["話す","見る","読む"]},{"id":20,"word":"watch","meaning":"見る","wrongChoices":["聞く","読む","書く"]},{"id":21,"word":"big","meaning":"大きい","wrongChoices":["小さい","高い","低い"]},{"id":22,"word":"small","meaning":"小さい","wrongChoices":["大きい","長い","短い"]},{"id":23,"word":"good","meaning":"良い","wrongChoices":["悪い","普通","最高"]},{"id":24,"word":"bad","meaning":"悪い","wrongChoices":["良い","普通","最悪"]},{"id":25,"word":"hot","meaning":"熱い","wrongChoices":["冷たい","温かい","涼しい"]},{"id":26,"word":"cold","meaning":"冷たい","wrongChoices":["熱い","温かい","暑い"]},{"id":27,"word":"happy","meaning":"嬉しい","wrongChoices":["悲しい","怒っている","眠い"]},{"id":28,"word":"sad","meaning":"悲しい","wrongChoices":["嬉しい","楽しい","怒っている"]},{"id":29,"word":"beautiful","meaning":"美しい","wrongChoices":["汚い","醜い","普通"]},{"id":30,"word":"water","meaning":"水","wrongChoices":["お茶","ジュース","牛乳"]}],"中級":[{"id":31,"word":"achieve","meaning":"達成する","wrongChoices":["失敗する","放棄する","無視する"]},{"id":32,"word":"analyze","meaning":"分析する","wrongChoices":["無視する","破壊する","作成する"]},{"id":33,"word":"approach","meaning":"近づく","wrongChoices":["離れる","逃げる","隠れる"]},{"id":34,"word":"benefit","meaning":"利益","wrongChoices":["損失","費用","負債"]},{"id":35,"word":"challenge","meaning":"挑戦","wrongChoices":["放棄","逃避","拒否"]},{"id":36,"word":"compare","meaning":"比較する","wrongChoices":["混同する","分離する","無視する"]},{"id":37,"word":"complete","meaning":"完了する","wrongChoices":["開始する","中断する","放棄する"]},{"id":38,"word":"consider","meaning":"考慮する","wrongChoices":["無視する","拒否する","忘れる"]},{"id":39,"word":"create","meaning":"創造する","wrongChoices":["破壊する","模倣する","放棄する"]},{"id":40,"word":"decide","meaning":"決定する","wrongChoices":["迷う","延期する","拒否する"]},{"id":41,"word":"develop","meaning":"発展させる","wrongChoices":["退化する","停止する","破壊する"]},{"id":42,"word":"discover","meaning":"発見する","wrongChoices":["隠す","失う","無視する"]},{"id":43,"word":"discuss","meaning":"議論する","wrongChoices":["無視する","隠す","放棄する"]},{"id":44,"word":"establish","meaning":"確立する","wrongChoices":["破壊する","放棄する","疑う"]},{"id":45,"word":"experience","meaning":"経験","wrongChoices":["理論","想像","無知"]},{"id":46,"word":"explain","meaning":"説明する","wrongChoices":["隠す","混乱させる","無視する"]},{"id":47,"word":"express","meaning":"表現する","wrongChoices":["隠す","抑える","忘れる"]},{"id":48,"word":"improve","meaning":"改善する","wrongChoices":["悪化させる","維持する","破壊する"]},{"id":49,"word":"include","meaning":"含む","wrongChoices":["除外する","分離する","拒否する"]},{"id":50,"word":"increase","meaning":"増加する","wrongChoices":["減少する","維持する","消滅する"]},{"id":51,"word":"important","meaning":"重要な","wrongChoices":["些細な","無関係な","不要な"]},{"id":52,"word":"possible","meaning":"可能な","wrongChoices":["不可能な","困難な","禁止された"]},{"id":53,"word":"necessary","meaning":"必要な","wrongChoices":["不要な","任意の","禁止された"]},{"id":54,"word":"different","meaning":"異なる","wrongChoices":["同じ","似ている","同一の"]},{"id":55,"word":"similar","meaning":"似ている","wrongChoices":["異なる","反対の","無関係な"]},{"id":56,"word":"various","meaning":"様々な","wrongChoices":["単一の","同じ","限定的な"]},{"id":57,"word":"available","meaning":"利用可能な","wrongChoices":["利用不可の","禁止された","制限された"]},{"id":58,"word":"effective","meaning":"効果的な","wrongChoices":["無効な","有害な","不適切な"]},{"id":59,"word":"significant","meaning":"重要な","wrongChoices":["些細な","無意味な","不要な"]},{"id":60,"word":"appropriate","meaning":"適切な","wrongChoices":["不適切な","不正な","無関係な"]}],"上級":[{"id":61,"word":"accommodate","meaning":"収容する","wrongChoices":["拒否する","追放する","制限する"]},{"id":62,"word":"anticipate","meaning":"予想する","wrongChoices":["無視する","驚く","忘れる"]},{"id":63,"word":"comprehensive","meaning":"包括的な","wrongChoices":["部分的な","限定的な","不完全な"]},{"id":64,"word":"consecutive","meaning":"連続した","wrongChoices":["断続的な","ランダムな","単独の"]},{"id":65,"word":"constitute","meaning":"構成する","wrongChoices":["破壊する","分解する","除外する"]},{"id":66,"word":"demonstrate","meaning":"実証する","wrongChoices":["隠す","否定する","疑う"]},{"id":67,"word":"deteriorate","meaning":"悪化する","wrongChoices":["改善する","維持する","強化する"]},{"id":68,"word":"elaborate","meaning":"詳しく述べる","wrongChoices":["要約する","省略する","隠す"]},{"id":69,"word":"eliminate","meaning":"排除する","wrongChoices":["含める","追加する","維持する"]},{"id":70,"word":"facilitate","meaning":"促進する","wrongChoices":["妨げる","遅らせる","禁止する"]},{"id":71,"word":"implementation","meaning":"実施","wrongChoices":["計画","理論","放棄"]},{"id":72,"word":"incorporate","meaning":"組み込む","wrongChoices":["除外する","分離する","拒否する"]},{"id":73,"word":"infrastructure","meaning":"インフラ","wrongChoices":["表層","装飾","付属品"]},{"id":74,"word":"initiative","meaning":"主導権","wrongChoices":["従属","受動","放棄"]},{"id":75,"word":"maintain","meaning":"維持する","wrongChoices":["放棄する","破壊する","変更する"]},{"id":76,"word":"maximize","meaning":"最大化する","wrongChoices":["最小化する","減少させる","制限する"]},{"id":77,"word":"methodology","meaning":"方法論","wrongChoices":["結果","目的","障害"]},{"id":78,"word":"mitigate","meaning":"緩和する","wrongChoices":["悪化させる","増強する","無視する"]},{"id":79,"word":"nevertheless","meaning":"それにもかかわらず","wrongChoices":["したがって","なぜなら","もし"]},{"id":80,"word":"paradigm","meaning":"範例","wrongChoices":["例外","逸脱","無秩序"]},{"id":81,"word":"prevalent","meaning":"流行している","wrongChoices":["稀しい","古い","消滅した"]},{"id":82,"word":"profound","meaning":"深遠な","wrongChoices":["浅い","表面的な","些細な"]},{"id":83,"word":"subsequent","meaning":"その後の","wrongChoices":["以前の","同時の","初期の"]},{"id":84,"word":"substantial","meaning":"相当な","wrongChoices":["些細な","不十分な","最小限の"]},{"id":85,"word":"sophisticated","meaning":"洗練された","wrongChoices":["単純な","粗野な","未発達の"]},{"id":86,"word":"reinforce","meaning":"強化する","wrongChoices":["弱める","破壊する","無視する"]},{"id":87,"word":"reluctant","meaning":"気が進まない","wrongChoices":["熱心な","積極的な","喜んでいる"]},{"id":88,"word":"resilient","meaning":"回復力のある","wrongChoices":["脆弱な","壊れやすい","弱い"]},{"id":89,"word":"substantial","meaning":"かなりの","wrongChoices":["わずかな","不十分な","無視できる"]},{"id":90,"word":"versatile","meaning":"多才な","wrongChoices":["専門的な","限定的な","単一の"]}]};

const mbtiQuestions=[{id:1,char:'🌙',name:'INFP魔法使い',bubble:'ねえねえ、友達と遊んだあとってどんな気分?',question:'友達と遊んだあと...',a:{text:'楽しくて元気いっぱい!もっと遊びたい',axis:'E'},b:{text:'楽しかったけど、少し疲れたかも',axis:'I'}},{id:2,char:'⚔️',name:'ENTJ騎士',bubble:'初対面の人と話すのは得意か?',question:'初めての人と話すと...',a:{text:'すぐに打ち解けられる',axis:'E'},b:{text:'少し時間がかかる',axis:'I'}},{id:3,char:'🌸',name:'ISFJ妖精',bubble:'大勢でワイワイと、少人数でゆっくり、どっちが好き?',question:'過ごし方として好きなのは...',a:{text:'大勢でワイワイ盛り上がる',axis:'E'},b:{text:'少人数でゆっくり話す',axis:'I'}},{id:4,char:'⚡',name:'ENTP精霊',bubble:'一人の時間、どれくらい必要?',question:'一人の時間は...',a:{text:'あまり必要ない、人といる方が好き',axis:'E'},b:{text:'とても大切、充電できる',axis:'I'}},{id:5,char:'🌙',name:'INFP魔法使い',bubble:'本を読むとき、どんなジャンルが好き?',question:'読書するなら...',a:{text:'ファンタジー、SF、可能性を感じる話',axis:'N'},b:{text:'実用書、事実に基づいた話',axis:'S'}},{id:6,char:'⚔️',name:'ENTJ騎士',bubble:'新しいことを学ぶとき、何を知りたい?',question:'学習するとき重視するのは...',a:{text:'全体像や将来の可能性',axis:'N'},b:{text:'具体的な手順や事実',axis:'S'}},{id:7,char:'🌸',name:'ISFJ妖精',bubble:'話をするとき、どんな風に伝える?',question:'誰かに話をすると...',a:{text:'抽象的な表現や比喩を使う',axis:'N'},b:{text:'具体的な例や事実を使う',axis:'S'}},{id:8,char:'⚡',name:'ENTP精霊',bubble:'現実と想像、どっちに時間を使う?',question:'考え事をすると...',a:{text:'未来や可能性について考える',axis:'N'},b:{text:'今ここにある現実を考える',axis:'S'}},{id:9,char:'🌙',name:'INFP魔法使い',bubble:'友達が悩んでたら、どうする?',question:'友達が困っていたら...',a:{text:'まず気持ちに寄り添って話を聞く',axis:'F'},b:{text:'解決策やアドバイスを考える',axis:'T'}},{id:10,char:'⚔️',name:'ENTJ騎士',bubble:'決断するとき、何を重視する?',question:'大切な選択をすると...',a:{text:'論理的に正しいかどうか',axis:'T'},b:{text:'人の気持ちや影響',axis:'F'}},{id:11,char:'🌸',name:'ISFJ妖精',bubble:'意見が対立したら、どう感じる?',question:'議論や対立が起きると...',a:{text:'ストレス、できれば避けたい',axis:'F'},b:{text:'刺激的、面白いと感じる',axis:'T'}},{id:12,char:'⚡',name:'ENTP精霊',bubble:'褒められるなら、何て言われたい?',question:'褒められるとしたら...',a:{text:'「優しいね」、「思いやりがあるね」',axis:'F'},b:{text:'「頭いいね」、「論理的だね」',axis:'T'}},{id:13,char:'🌙',name:'INFP魔法使い',bubble:'週末の予定、どうやって決める?',question:'休日の過ごし方は...',a:{text:'その時の気分で自由に決める',axis:'P'},b:{text:'事前に計画を立てておく',axis:'J'}},{id:14,char:'⚔️',name:'ENTJ騎士',bubble:'締め切りがある課題、いつやる?',question:'やるべきことがあると...',a:{text:'早めに終わらせて安心したい',axis:'J'},b:{text:'締め切り直前にやる方が集中できる',axis:'P'}},{id:15,char:'🌸',name:'ISFJ妖精',bubble:'部屋の状態、どんな感じ?',question:'あなたの部屋は...',a:{text:'きちんと整理整頓されている',axis:'J'},b:{text:'自由な感じ、創造的な散らかり方',axis:'P'}},{id:16,char:'⚡',name:'ENTP精霊',bubble:'予定が変わったら、どう思う?',question:'急な予定変更があると...',a:{text:'柔軟に対応、むしろ楽しい',axis:'P'},b:{text:'ストレス、計画通りがいい',axis:'J'}}];

const typeInfo={'INFP':{char:'🌙',name:'INFP - 夢見る魔法使い',desc:'あなたは想像力豊かで優しい心の持ち主。言葉の世界で自由に冒険しましょう!'},'ENFP':{char:'🌙',name:'ENFP - 夢見る魔法使い',desc:'あなたは想像力豊かで優しい心の持ち主。言葉の世界で自由に冒険しましょう!'},'INFJ':{char:'🌙',name:'INFJ - 夢見る魔法使い',desc:'あなたは想像力豊かで優しい心の持ち主。言葉の世界で自由に冒険しましょう!'},'ISFP':{char:'🌙',name:'ISFP - 夢見る魔法使い',desc:'あなたは想像力豊かで優しい心の持ち主。言葉の世界で自由に冒険しましょう!'},'ENFJ':{char:'⚔️',name:'ENFJ - 勇敢な騎士',desc:'あなたはリーダーシップと決断力を持つ勇者。目標に向かって突き進みましょう!'},'ENTJ':{char:'⚔️',name:'ENTJ - 勇敢な騎士',desc:'あなたはリーダーシップと決断力を持つ勇者。目標に向かって突き進みましょう!'},'ESTJ':{char:'⚔️',name:'ESTJ - 勇敢な騎士',desc:'あなたはリーダーシップと決断力を持つ勇者。目標に向かって突き進みましょう!'},'INTJ':{char:'⚔️',name:'INTJ - 勇敢な騎士',desc:'あなたはリーダーシップと決断力を持つ勇者。目標に向かって突き進みましょう!'},'ISFJ':{char:'🌸',name:'ISFJ - 癒しの妖精',desc:'あなたは思いやりと献身の心を持つ優しい存在。言葉で人を癒しましょう!'},'ESFJ':{char:'🌸',name:'ESFJ - 癒しの妖精',desc:'あなたは思いやりと献身の心を持つ優しい存在。言葉で人を癒しましょう!'},'ISTJ':{char:'🌸',name:'ISTJ - 癒しの妖精',desc:'あなたは思いやりと献身の心を持つ優しい存在。言葉で人を癒しましょう!'},'ENTP':{char:'⚡',name:'ENTP - 発明家の精霊',desc:'あなたは好奇心旺盛で革新的な発明家。新しい言葉を生み出しましょう!'},'ESTP':{char:'⚡',name:'ESTP - 発明家の精霊',desc:'あなたは好奇心旺盛で革新的な発明家。新しい言葉を生み出しましょう!'},'INTP':{char:'⚡',name:'INTP - 発明家の精霊',desc:'あなたは好奇心旺盛で革新的な発明家。新しい言葉を生み出しましょう!'},'ESFP':{char:'⚡',name:'ESFP - 発明家の精霊',desc:'あなたは好奇心旺盛で革新的な発明家。新しい言葉を生み出しましょう!'},'ISTP':{char:'⚡',name:'ISTP - 発明家の精霊',desc:'あなたは好奇心旺盛で革新的な発明家。新しい言葉を生み出しましょう!'}};

let currentScreen='splashScreen',mbtiCurrentQ=0,mbtiAnswers={E:0,I:0,S:0,N:0,T:0,F:0,J:0,P:0},userMBTI='',userCharacter='',selectedLevel='',quizQuestions=[],currentQuizQ=0,correctCount=0,userData={mbti:'',character:'',level:1,exp:0,maxExp:100,selectedLevel:'',todayQuizCount:0,totalWords:0,consecutiveDays:1,stats:{dailyHistory:[],wordHistory:{},totalQuizzes:0,totalCorrect:0,totalQuestions:0,studyTime:0,lastStudyDate:''}};

function loadUserData(){const saved=localStorage.getItem('kotobaTamagoData');if(saved){userData=JSON.parse(saved);if(!userData.stats){userData.stats={dailyHistory:[],wordHistory:{},totalQuizzes:0,totalCorrect:0,totalQuestions:0,studyTime:0,lastStudyDate:''}}return true}return false}
function saveUserData(){localStorage.setItem('kotobaTamagoData',JSON.stringify(userData))}
function showScreen(screenId){document.getElementById(currentScreen).classList.remove('active');document.getElementById(screenId).classList.add('active');currentScreen=screenId}
function loadMBTIQuestion(){
    const q=mbtiQuestions[mbtiCurrentQ];
    document.getElementById('mbtiCurrentQ').textContent=mbtiCurrentQ+1;
    document.getElementById('mbtiCharAvatar').textContent=q.char;
    document.getElementById('mbtiBubble').textContent=q.bubble;
    document.getElementById('mbtiQuestion').textContent=q.question;
    
    const choicesDiv = document.getElementById('mbtiChoices');
    choicesDiv.innerHTML = '';
    
    const btnA = document.createElement('button');
    btnA.className = 'choice-button';
    btnA.innerHTML = `<span style="font-weight:bold;color:#9B7ED9;">A.</span> ${q.a.text}`;
    btnA.addEventListener('click', () => answerMBTI(q.a.axis));
    
    const btnB = document.createElement('button');
    btnB.className = 'choice-button';
    btnB.innerHTML = `<span style="font-weight:bold;color:#9B7ED9;">B.</span> ${q.b.text}`;
    btnB.addEventListener('click', () => answerMBTI(q.b.axis));
    
    choicesDiv.appendChild(btnA);
    choicesDiv.appendChild(btnB);
}
function answerMBTI(axis){mbtiAnswers[axis]++;mbtiCurrentQ++;if(mbtiCurrentQ<mbtiQuestions.length){setTimeout(()=>loadMBTIQuestion(),300)}else{calculateMBTIResult()}}
function calculateMBTIResult(){
    userMBTI=(mbtiAnswers.E>mbtiAnswers.I?'E':'I')+(mbtiAnswers.S>mbtiAnswers.N?'S':'N')+(mbtiAnswers.T>mbtiAnswers.F?'T':'F')+(mbtiAnswers.J>mbtiAnswers.P?'J':'P');
    const info=typeInfo[userMBTI];
    userCharacter=info.char;
    userData.mbti=userMBTI;
    userData.character=userCharacter;
    document.getElementById('resultChar').textContent=info.char;
    document.getElementById('resultType').textContent=userMBTI;
    document.getElementById('resultName').textContent=info.name;
    document.getElementById('resultDesc').textContent=info.desc;
    
    setTimeout(() => {
        const continueBtn = document.getElementById('continueBtn');
        const newBtn = continueBtn.cloneNode(true);
        continueBtn.parentNode.replaceChild(newBtn, continueBtn);
        newBtn.addEventListener('click', goToLevelSelect);
    }, 100);
    
    showScreen('resultScreen');
}
function goToLevelSelect(){
    showScreen('levelSelectScreen');
    
    setTimeout(() => {
        document.getElementById('levelBeginner').addEventListener('click', () => selectLevel('初級'));
        document.getElementById('levelIntermediate').addEventListener('click', () => selectLevel('中級'));
        document.getElementById('levelAdvanced').addEventListener('click', () => selectLevel('上級'));
    }, 100);
}

function selectLevel(level){
    selectedLevel=level;
    userData.selectedLevel=level;
    saveUserData();
    updateHomeScreen();
    showScreen('homeScreen');
    
    setTimeout(() => {
        const charDisplay = document.getElementById('homeCharacter');
        const newCharDisplay = charDisplay.cloneNode(true);
        charDisplay.parentNode.replaceChild(newCharDisplay, charDisplay);
        newCharDisplay.addEventListener('click', characterTap);
        
        const quizBtn = document.getElementById('quizStartBtn');
        const newQuizBtn = quizBtn.cloneNode(true);
        quizBtn.parentNode.replaceChild(newQuizBtn, quizBtn);
        newQuizBtn.addEventListener('click', startQuiz);
    }, 100);
}
function updateHomeScreen(){
    const info=typeInfo[userData.mbti];
    document.getElementById('homeCharName').textContent=info.name;
    document.getElementById('homeLevel').textContent='Lv.'+userData.level;
    document.getElementById('homeCharacter').textContent=userData.character;
    document.getElementById('homeExp').textContent=userData.exp;
    document.getElementById('homeMaxExp').textContent=userData.maxExp;
    document.getElementById('homeExpBar').style.width=(userData.exp/userData.maxExp*100)+'%';
    document.getElementById('todayCount').textContent=userData.todayQuizCount;
    document.getElementById('consecutiveDays').textContent=userData.consecutiveDays;
    document.getElementById('totalWords').textContent=userData.totalWords;
    
    setTimeout(() => {
        const charDisplay = document.getElementById('homeCharacter');
        const newCharDisplay = charDisplay.cloneNode(true);
        charDisplay.parentNode.replaceChild(newCharDisplay, charDisplay);
        newCharDisplay.addEventListener('click', characterTap);
        
        const quizBtn = document.getElementById('quizStartBtn');
        const newQuizBtn = quizBtn.cloneNode(true);
        quizBtn.parentNode.replaceChild(newQuizBtn, quizBtn);
        newQuizBtn.addEventListener('click', startQuiz);
    }, 100);
}
function characterTap(){const char=document.getElementById('homeCharacter');char.textContent='🌟😊';setTimeout(()=>{char.textContent=userData.character},500)}
function startQuiz(){if(userData.todayQuizCount>=10){alert('今日のクイズは終了しました!\n明日また挑戦してください。');return}const levelWords=wordsData[userData.selectedLevel];const shuffled=[...levelWords].sort(()=>Math.random()-0.5);quizQuestions=shuffled.slice(0,10);currentQuizQ=0;correctCount=0;document.getElementById('quizChar').textContent=userData.character;loadQuizQuestion();showScreen('quizScreen')}
function loadQuizQuestion(){
    const q=quizQuestions[currentQuizQ];
    document.getElementById('quizNum').textContent=currentQuizQ+1;
    document.getElementById('quizWord').textContent=q.word;
    document.getElementById('cheerMsg').textContent='頑張って!';
    
    const choices=[q.meaning,...q.wrongChoices].sort(()=>Math.random()-0.5);
    const choicesDiv = document.getElementById('quizChoices');
    choicesDiv.innerHTML = '';
    
    choices.forEach(choice => {
        const btn = document.createElement('button');
        btn.className = 'choice-button';
        btn.textContent = choice;
        btn.addEventListener('click', () => answerQuiz(choice, q.meaning));
        choicesDiv.appendChild(btn);
    });
}
function answerQuiz(selected,correct){
    const isCorrect=selected===correct;
    const word = quizQuestions[currentQuizQ].word;
    
    if(!userData.stats.wordHistory[word]) {
        userData.stats.wordHistory[word] = {correct: 0, total: 0};
    }
    userData.stats.wordHistory[word].total++;
    if(isCorrect) {
        userData.stats.wordHistory[word].correct++;
        correctCount++;
        document.getElementById('cheerMsg').textContent='すごい!';
    } else {
        document.getElementById('cheerMsg').textContent='次頑張ろう!';
    }
    
    const buttons=document.querySelectorAll('#quizChoices .choice-button');
    buttons.forEach(btn=>{
        if(btn.textContent===correct){btn.classList.add('correct')}
        else if(btn.textContent===selected&&!isCorrect){btn.classList.add('wrong')}
        btn.disabled=true
    });
    
    setTimeout(()=>{
        currentQuizQ++;
        if(currentQuizQ<quizQuestions.length){loadQuizQuestion()}
        else{showQuizResult()}
    },1500);
}
function showQuizResult(){
    const earnedExp=correctCount*10;
    userData.exp+=earnedExp;
    userData.todayQuizCount++;
    userData.totalWords+=correctCount;
    
    userData.stats.totalQuizzes++;
    userData.stats.totalCorrect += correctCount;
    userData.stats.totalQuestions += quizQuestions.length;
    userData.stats.studyTime += 3;
    
    const today = new Date().toISOString().split('T')[0];
    if(!userData.stats.dailyHistory.includes(today)) {
        userData.stats.dailyHistory.push(today);
    }
    userData.stats.lastStudyDate = today;
    
    updateConsecutiveDays();
    
    let leveledUp = false;
    
    while(userData.exp>=userData.maxExp){
        userData.exp-=userData.maxExp;
        userData.level++;
        userData.maxExp=Math.floor(userData.maxExp*1.5);
        leveledUp = true;
    }
    
    saveUserData();
    document.getElementById('quizResultChar').textContent=userData.character+'😊';
    document.getElementById('finalScore').textContent=correctCount;
    document.getElementById('finalExpEarned').textContent=earnedExp;
    
    const backBtn = document.getElementById('backHomeBtn');
    const newBackBtn = backBtn.cloneNode(true);
    backBtn.parentNode.replaceChild(newBackBtn, backBtn);
    
    if(leveledUp) {
        newBackBtn.addEventListener('click', () => showLevelUpScreen(userData.level));
    } else {
        newBackBtn.addEventListener('click', backToHome);
    }
    
    showScreen('quizResultScreen');
}

function updateConsecutiveDays() {
    const today = new Date();
    const yesterday = new Date(today);
    yesterday.setDate(yesterday.getDate() - 1);
    
    const todayStr = today.toISOString().split('T')[0];
    const yesterdayStr = yesterday.toISOString().split('T')[0];
    
    if(userData.stats.dailyHistory.includes(yesterdayStr) || userData.stats.dailyHistory.includes(todayStr)) {
        if(userData.stats.lastStudyDate === yesterdayStr) {
            userData.consecutiveDays++;
        }
    } else {
        userData.consecutiveDays = 1;
    }
}

function showLevelUpScreen(newLevel) {
    document.getElementById('levelUpChar').textContent = userData.character;
    document.getElementById('newLevelNumber').textContent = newLevel;
    
    const messages = [
        'おめでとうございます！',
        'すごい！レベルアップです！',
        '素晴らしい成長です！',
        '次のステージへ！'
    ];
    document.getElementById('levelUpMessage').textContent = messages[Math.floor(Math.random() * messages.length)];
    
    showScreen('levelUpScreen');
    
    setTimeout(() => {
        const continueBtn = document.getElementById('levelUpContinueBtn');
        const newBtn = continueBtn.cloneNode(true);
        continueBtn.parentNode.replaceChild(newBtn, continueBtn);
        newBtn.addEventListener('click', backToHome);
    }, 100);
}
function backToHome(){
    updateHomeScreen();
    showScreen('homeScreen');
    
    setTimeout(() => {
        const charDisplay = document.getElementById('homeCharacter');
        const newCharDisplay = charDisplay.cloneNode(true);
        charDisplay.parentNode.replaceChild(newCharDisplay, charDisplay);
        newCharDisplay.addEventListener('click', characterTap);
        
        const quizBtn = document.getElementById('quizStartBtn');
        const newQuizBtn = quizBtn.cloneNode(true);
        quizBtn.parentNode.replaceChild(newQuizBtn, quizBtn);
        newQuizBtn.addEventListener('click', startQuiz);
    }, 100);
}

function openSettings() {
    const info = typeInfo[userData.mbti];
    document.getElementById('settingsMBTI').textContent = `${userData.mbti} - ${info.name}`;
    document.getElementById('settingsLevel').textContent = userData.selectedLevel;
    document.getElementById('settingsCurrentLevel').textContent = `Lv.${userData.level}`;
    document.getElementById('settingsExp').textContent = `${userData.exp} / ${userData.maxExp}`;
    document.getElementById('settingsTotalWords').textContent = `${userData.totalWords}個`;
    document.getElementById('settingsStreak').textContent = `🔥 ${userData.consecutiveDays}日`;
    
    document.getElementById('settingsModal').classList.add('active');
}

function closeSettings() {
    document.getElementById('settingsModal').classList.remove('active');
}

document.addEventListener('click', function(e) {
    const modal = document.getElementById('settingsModal');
    if (e.target === modal) {
        closeSettings();
    }
    const statsModal = document.getElementById('statsModal');
    if (e.target === statsModal) {
        closeStats();
    }
});

function retakeMBTI() {
    if (confirm('MBTI診断をやり直しますか?\n現在のキャラクターとの思い出は残りますが、新しいキャラクターに変わります。')) {
        mbtiCurrentQ = 0;
        mbtiAnswers = {E:0, I:0, S:0, N:0, T:0, F:0, J:0, P:0};
        closeSettings();
        loadMBTIQuestion();
        showScreen('mbtiScreen');
    }
}

function changeLevelDialog() {
    closeSettings();
    showScreen('levelSelectScreen');
}

function resetAllData() {
    if (confirm('本当に全てのデータをリセットしますか?\nこの操作は取り消せません。')) {
        localStorage.removeItem('kotobaTamagoData');
        location.reload();
    }
}

function addDebugExp() {
    userData.exp += 100;
    while(userData.exp >= userData.maxExp) {
        userData.exp -= userData.maxExp;
        userData.level++;
        userData.maxExp = Math.floor(userData.maxExp * 1.5);
        showLevelUpScreen(userData.level);
    }
    saveUserData();
    openSettings();
    updateHomeScreen();
}

function addDebugLevel() {
    userData.level++;
    userData.exp = 0;
    userData.maxExp = Math.floor(userData.maxExp * 1.5);
    saveUserData();
    showLevelUpScreen(userData.level);
}

function openStats() {
    document.getElementById('statTotalQuizzes').textContent = userData.stats.totalQuizzes + '回';
    document.getElementById('statTotalCorrect').textContent = userData.stats.totalCorrect + '問';
    const accuracy = userData.stats.totalQuestions > 0 
        ? Math.round((userData.stats.totalCorrect / userData.stats.totalQuestions) * 100) 
        : 0;
    document.getElementById('statAccuracy').textContent = accuracy + '%';
    document.getElementById('statTotalWords').textContent = userData.totalWords + '個';
    
    const levelProgress = {
        '初級': 0,
        '中級': 0,
        '上級': 0
    };
    
    Object.keys(userData.stats.wordHistory).forEach(word => {
        const wordData = wordsData['初級'].find(w => w.word === word);
        if(wordData && userData.stats.wordHistory[word].correct > 0) levelProgress['初級']++;
        
        const wordData2 = wordsData['中級'].find(w => w.word === word);
        if(wordData2 && userData.stats.wordHistory[word].correct > 0) levelProgress['中級']++;
        
        const wordData3 = wordsData['上級'].find(w => w.word === word);
        if(wordData3 && userData.stats.wordHistory[word].correct > 0) levelProgress['上級']++;
    });
    
    document.getElementById('progressBeginnerText').textContent = `${levelProgress['初級']}/30`;
    document.getElementById('progressBeginner').style.width = `${(levelProgress['初級']/30)*100}%`;
    
    document.getElementById('progressIntermediateText').textContent = `${levelProgress['中級']}/30`;
    document.getElementById('progressIntermediate').style.width = `${(levelProgress['中級']/30)*100}%`;
    
    document.getElementById('progressAdvancedText').textContent = `${levelProgress['上級']}/30`;
    document.getElementById('progressAdvanced').style.width = `${(levelProgress['上級']/30)*100}%`;
    
    document.getElementById('streakDays').textContent = userData.consecutiveDays;
    
    renderCalendar();
    
    document.getElementById('studyTimeDisplay').textContent = userData.stats.studyTime;
    
    renderWordAnalysis();
    
    document.getElementById('statsModal').classList.add('active');
}

function closeStats() {
    document.getElementById('statsModal').classList.remove('active');
}

function renderCalendar() {
    const grid = document.getElementById('calendarGrid');
    grid.innerHTML = '';
    
    const today = new Date();
    const studyDates = userData.stats.dailyHistory || [];
    
    for(let i = 27; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(date.getDate() - i);
        const dateStr = date.toISOString().split('T')[0];
        
        const dayDiv = document.createElement('div');
        dayDiv.className = 'calendar-day';
        dayDiv.textContent = date.getDate();
        
        if(studyDates.includes(dateStr)) {
            dayDiv.classList.add('studied');
        }
        
        if(i === 0) {
            dayDiv.classList.add('today');
        }
        
        grid.appendChild(dayDiv);
    }
}

function renderWordAnalysis() {
    const wordHistory = userData.stats.wordHistory || {};
    const words = Object.keys(wordHistory);
    
    if(words.length === 0) {
        document.getElementById('goodWords').innerHTML = '<div style="text-align:center; color:#94a3b8; padding:20px;">まだデータがありません</div>';
        document.getElementById('badWords').innerHTML = '<div style="text-align:center; color:#94a3b8; padding:20px;">まだデータがありません</div>';
        return;
    }
    
    const wordStats = words.map(word => {
        const data = wordHistory[word];
        const accuracy = data.total > 0 ? (data.correct / data.total) * 100 : 0;
        return { word, accuracy, total: data.total };
    }).filter(w => w.total > 0);
    
    const goodWords = [...wordStats].sort((a, b) => b.accuracy - a.accuracy).slice(0, 3);
    const goodWordsHTML = goodWords.map(w => `
        <div class="word-item">
            <span class="word-name">${w.word}</span>
            <span class="word-accuracy good">${Math.round(w.accuracy)}%</span>
        </div>
    `).join('');
    document.getElementById('goodWords').innerHTML = goodWordsHTML || '<div style="text-align:center; color:#94a3b8; padding:20px;">データなし</div>';
    
    const badWords = [...wordStats].sort((a, b) => a.accuracy - b.accuracy).slice(0, 3);
    const badWordsHTML = badWords.map(w => `
        <div class="word-item">
            <span class="word-name">${w.word}</span>
            <span class="word-accuracy bad">${Math.round(w.accuracy)}%</span>
        </div>
    `).join('');
    document.getElementById('badWords').innerHTML = badWordsHTML || '<div style="text-align:center; color:#94a3b8; padding:20px;">データなし</div>';
}

function init(){
    const hasData=loadUserData();
    
    document.getElementById('levelBeginner').addEventListener('click', () => selectLevel('初級'));
    document.getElementById('levelIntermediate').addEventListener('click', () => selectLevel('中級'));
    document.getElementById('levelAdvanced').addEventListener('click', () => selectLevel('上級'));
    
    document.getElementById('closeSettings').addEventListener('click', closeSettings);
    document.getElementById('retakeMBTI').addEventListener('click', retakeMBTI);
    document.getElementById('changeLevel').addEventListener('click', changeLevelDialog);
    document.getElementById('resetData').addEventListener('click', resetAllData);
    document.getElementById('addExp100').addEventListener('click', addDebugExp);
    document.getElementById('addLevel1').addEventListener('click', addDebugLevel);
    
    document.getElementById('closeStats').addEventListener('click', closeStats);
    
    if(hasData&&userData.mbti){
        setTimeout(()=>{updateHomeScreen();showScreen('homeScreen')},3000)
    }else{
        setTimeout(()=>{loadMBTIQuestion();showScreen('mbtiScreen')},5000)
    }
}
init();
    </script>
</body>
</html>
```

---

## ⚠️ 注意事項

このHTMLファイルは**非常に長いです**（約1000行以上）。GitHubのWeb UIでは以下の点に注意してください：

1. **貼り付け時間**: 数秒かかる場合があります
2. **スクロール**: 全体を確認するには少し時間がかかります
3. **保存時間**: コミット時に少し待つ必要があります

---

## ✅ 簡単な手順まとめ
```
1. 上記のHTMLコードを全選択（Ctrl+A）
2. コピー（Ctrl+C）
3. GitHub → リポジトリ → Add file → Create new file
4. ファイル名: original-kotoba-full.html
5. 貼り付け（Ctrl+V）
6. Commit new file
7. 完了！🎉
